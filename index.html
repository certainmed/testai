
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Leftover Chef - Generator Resep Pintar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF9F43;
            --success: #2DCC71;
            --warning: #F39C12;
            --danger: #E74C3C;
            --secondary: #95A5A6;
            --bg-light: #FFFFFF;
            --bg-dark: #F5F5F5;
            --text-dark: #2C3E50;
            --text-light: #7F8C8D;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, #FF8C1A 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 40% 60%;
            gap: 30px;
            margin-bottom: 40px;
        }

        .panel {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }

        .panel h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95em;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 159, 67, 0.1);
        }

        input[type="text"].error,
        input[type="number"].error,
        select.error {
            border-color: var(--danger);
            background-color: rgba(231, 76, 60, 0.05);
        }

        .input-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
        }

        .ingredient-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            min-height: 30px;
        }

        .tag {
            background: linear-gradient(135deg, var(--primary) 0%, #FF8C1A 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            box-shadow: 0 2px 8px rgba(255, 159, 67, 0.3);
        }

        .tag button {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            cursor: pointer;
            font-weight: bold;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .tag button:hover {
            background: rgba(255,255,255,0.5);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #FF8C1A 100%);
            color: white;
            flex: 1;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 159, 67, 0.3);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #7F8C8D;
        }

        .error-message {
            color: var(--danger);
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            min-height: 200px;
        }

        .recipe-card {
            background: var(--bg-light);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 25px rgba(0,0,0,0.15);
        }

        .recipe-header {
            background: linear-gradient(135deg, var(--primary) 0%, #FF8C1A 100%);
            color: white;
            padding: 20px;
        }

        .recipe-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .recipe-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255,255,255,0.3);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .recipe-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
        }

        .recipe-section {
            margin-bottom: 15px;
        }

        .recipe-section h4 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .recipe-section ul,
        .recipe-section ol {
            margin-left: 20px;
            font-size: 0.95em;
            line-height: 1.8;
        }

        .recipe-section li {
            margin-bottom: 6px;
            color: var(--text-dark);
        }

        .warning-box {
            background-color: rgba(243, 156, 18, 0.1);
            border-left: 4px solid var(--warning);
            padding: 12px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--text-dark);
        }

        .tips-box {
            background-color: rgba(45, 204, 113, 0.1);
            border-left: 4px solid var(--success);
            padding: 12px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--text-dark);
        }

        .recipe-footer {
            padding: 15px 20px;
            border-top: 1px solid #E0E0E0;
            display: flex;
            gap: 8px;
        }

        .recipe-footer button {
            flex: 1;
            padding: 10px;
            font-size: 0.9em;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .recipe-footer button:hover {
            background: var(--primary);
            color: white;
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            gap: 20px;
        }

        .loading-animation {
            display: flex;
            gap: 10px;
            font-size: 2em;
        }

        .cooking-icon {
            animation: cook 1s ease-in-out infinite;
        }

        @keyframes cook {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #E0E0E0;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, #FF8C1A 100%);
            animation: progress 2s ease-in-out infinite;
        }

        @keyframes progress {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 100%; }
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .empty-state p {
            margin-bottom: 0;
            font-size: 1.1em;
        }

        footer {
            background: var(--text-dark);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }

        .success-message {
            background-color: rgba(45, 204, 113, 0.1);
            border-left: 4px solid var(--success);
            color: var(--success);
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 15px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 50% 50%;
            }
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 1.8em;
            }

            .input-row {
                grid-template-columns: 1fr;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .recipes-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üç≥ Smart Leftover Chef</h1>
        <p>Ubah sisa bahan menjadi hidangan lezat dengan bantuan AI</p>
    </header>

    <div class="container">
        <div class="main-grid">
            <!-- LEFT PANEL: INPUT FORM -->
            <div class="panel">
                <h2>üìù Bahan Anda</h2>
                <div id="successMessage" class="success-message"></div>

                <!-- Input Bahan -->
                <div class="form-group">
                    <label>Nama Bahan</label>
                    <input type="text" id="ingredientName" placeholder="Contoh: Telur Ayam, Tomat Segar" maxlength="50">
                    <div class="error-message" id="nameError"></div>
                </div>

                <div class="input-row">
                    <div class="form-group" style="grid-column: 1;">
                        <label>Berat/Jumlah</label>
                        <input type="number" id="ingredientAmount" placeholder="3" min="0.1" max="10000" step="0.1">
                        <div class="error-message" id="amountError"></div>
                    </div>
                    <div class="form-group" style="grid-column: 2;">
                        <label>Unit</label>
                        <select id="ingredientUnit">
                            <option value="">Pilih Unit</option>
                            <option value="gram">gram</option>
                            <option value="ml">ml</option>
                            <option value="butir">butir</option>
                            <option value="ikat">ikat</option>
                            <option value="potong">potong</option>
                            <option value="sendok makan">sdm</option>
                            <option value="cangkir">cangkir</option>
                        </select>
                        <div class="error-message" id="unitError"></div>
                    </div>
                    <div class="form-group" style="grid-column: 3;">
                        <label>Kategori</label>
                        <select id="ingredientCategory">
                            <option value="">Pilih Kategori</option>
                            <option value="Protein">Protein</option>
                            <option value="Sayuran">Sayuran</option>
                            <option value="Karbohidrat">Karbohidrat</option>
                            <option value="Dairy">Dairy</option>
                            <option value="Buah">Buah</option>
                        </select>
                        <div class="error-message" id="categoryError"></div>
                    </div>
                </div>

                <div class="ingredient-tags" id="ingredientTags"></div>

                <p style="font-size: 0.85em; color: var(--text-light); margin-top: 10px;">
                    üí° Tip: Tekan <strong>Enter</strong> untuk menambah bahan atau <strong>CTRL + Enter</strong> untuk generate resep
                </p>

                <!-- Bumbu Section -->
                <h2 style="margin-top: 30px;">üå∂Ô∏è Bumbu Tersedia</h2>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-garam" checked>
                        <label for="bumbu-garam">Garam</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-gula" checked>
                        <label for="bumbu-gula">Gula</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-merica" checked>
                        <label for="bumbu-merica">Merica</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-minyak" checked>
                        <label for="bumbu-minyak">Minyak Goreng</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-kecap" checked>
                        <label for="bumbu-kecap">Kecap Manis</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-bawang-putih" checked>
                        <label for="bumbu-bawang-putih">Bawang Putih</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-bawang-merah" checked>
                        <label for="bumbu-bawang-merah">Bawang Merah</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-cabai">
                        <label for="bumbu-cabai">Cabai</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-santan">
                        <label for="bumbu-santan">Santan</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-kemiri">
                        <label for="bumbu-kemiri">Kemiri</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-kunyit">
                        <label for="bumbu-kunyit">Kunyit</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bumbu-jahe">
                        <label for="bumbu-jahe">Jahe</label>
                    </div>
                </div>

                <!-- Preferensi Section -->
                <h2 style="margin-top: 30px;">‚öôÔ∏è Preferensi</h2>

                <div class="form-group">
                    <label>Tingkat Pedas</label>
                    <select id="spiceLevel">
                        <option value="Tidak Pedas">Tidak Pedas</option>
                        <option value="Ringan">Ringan üå∂Ô∏è</option>
                        <option value="Sedang">Sedang üå∂Ô∏èüå∂Ô∏è</option>
                        <option value="Pedas">Pedas üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è</option>
                        <option value="Super Pedas">Super Pedas üî•üî•üî•</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Metode Masak</label>
                    <select id="cookingMethod">
                        <option value="Semua">Semua Metode</option>
                        <option value="Goreng">Goreng</option>
                        <option value="Rebus">Rebus</option>
                        <option value="Kukus">Kukus</option>
                        <option value="Panggang">Panggang</option>
                        <option value="Tumis">Tumis</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Waktu Maksimal</label>
                    <select id="maxTime">
                        <option value="15">15 Menit</option>
                        <option value="30">30 Menit</option>
                        <option value="45">45 Menit</option>
                        <option value="60">60 Menit</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tingkat Kesulitan</label>
                    <select id="difficulty">
                        <option value="Mudah">Mudah</option>
                        <option value="Sedang">Sedang</option>
                        <option value="Sulit">Sulit</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Alergi/Hindari (pisahkan dengan koma)</label>
                    <textarea id="allergies" placeholder="Contoh: Kacang, Telur, Seafood" rows="3"></textarea>
                </div>

                <div class="button-group">
                    <button class="btn-primary" id="generateBtn" onclick="generateRecipes()">üç≥ Masak Sekarang!</button>
                </div>
            </div>

            <!-- RIGHT PANEL: RESULTS -->
            <div class="panel">
                <h2>üë®‚Äçüç≥ Resep Anda</h2>
                <div id="recipesContainer" class="recipes-grid">
                    <div class="empty-state">
                        <p>üìä Masukkan bahan dan klik "Masak Sekarang!" untuk melihat resep</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Smart Leftover Chef - Ubah Sisa Jadi Istimewa ‚ú®</p>
    </footer>

    <script>
        // State Management
        const state = {
            ingredients: [],
            favorites: loadFromLocalStorage('favorites') || [],
            history: loadFromLocalStorage('history') || [],
            spices: {}
        };

        // Initialize spice selections from localStorage
        function initializeSpices() {
            const savedSpices = loadFromLocalStorage('spices');
            if (savedSpices) {
                Object.keys(savedSpices).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) element.checked = savedSpices[key];
                });
            }
        }

        // LocalStorage Helpers
        function saveToLocalStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.warn('LocalStorage error:', e);
            }
        }

        function loadFromLocalStorage(key) {
            try {
                return JSON.parse(localStorage.getItem(key));
            } catch (e) {
                return null;
            }
        }

        // Unit Conversion
        const unitConversion = {
            'butir': 50,
            'ikat': 200,
            'potong': 100,
            'sendok makan': 15,
            'cangkir': 240,
            'gram': 1,
            'ml': 1
        };

        function convertToGrams(amount, unit) {
            return amount * (unitConversion[unit] || 1);
        }

        // Input Validation
        function validateIngredient() {
            const name = document.getElementById('ingredientName').value.trim();
            const amount = parseFloat(document.getElementById('ingredientAmount').value);
            const unit = document.getElementById('ingredientUnit').value;
            const category = document.getElementById('ingredientCategory').value;

            let isValid = true;
            const errors = { name: '', amount: '', unit: '', category: '' };

            if (!name || name.length < 2 || name.length > 50) {
                errors.name = 'Nama bahan harus 2-50 karakter';
                isValid = false;
            }

            if (!amount || amount < 0.1 || amount > 10000) {
                errors.amount = 'Jumlah harus 0.1-10000';
                isValid = false;
            }

            if (!unit) {
                errors.unit = 'Pilih unit';
                isValid = false;
            }

            if (!category) {
                errors.category = 'Pilih kategori';
                isValid = false;
            }

            if (state.ingredients.some(ing => ing.name.toLowerCase() === name.toLowerCase())) {
                errors.name = 'Bahan sudah ditambahkan';
                isValid = false;
            }

            showErrors(errors);
            return isValid;
        }

        function showErrors(errors) {
            Object.keys(errors).forEach(field => {
                const errorEl = document.getElementById(`${field}Error`);
                if (errorEl) {
                    if (errors[field]) {
                        errorEl.textContent = errors[field];
                        errorEl.classList.add('show');
                        document.getElementById(`ingredient${field.charAt(0).toUpperCase() + field.slice(1)}`).classList.add('error');
                    } else {
                        errorEl.classList.remove('show');
                        document.getElementById(`ingredient${field.charAt(0).toUpperCase() + field.slice(1)}`).classList.remove('error');
                    }
                }
            });
        }

        // Add Ingredient
        function addIngredient() {
            if (!validateIngredient()) return;

            const name = document.getElementById('ingredientName').value.trim();
            const amount = parseFloat(document.getElementById('ingredientAmount').value);
            const unit = document.getElementById('ingredientUnit').value;
            const category = document.getElementById('ingredientCategory').value;

            state.ingredients.push({ name, amount, unit, category, grams: convertToGrams(amount, unit) });
            
            clearIngredientForm();
            renderTags();
            document.getElementById('ingredientName').focus();
        }

        function clearIngredientForm() {
            document.getElementById('ingredientName').value = '';
            document.getElementById('ingredientAmount').value = '';
            document.getElementById('ingredientUnit').value = '';
            document.getElementById('ingredientCategory').value = '';
            showErrors({ name: '', amount: '', unit: '', category: '' });
        }

        function removeIngredient(index) {
            state.ingredients.splice(index, 1);
            renderTags();
        }

        function renderTags() {
            const container = document.getElementById('ingredientTags');
            container.innerHTML = state.ingredients.map((ing, idx) => `
                <div class="tag">
                    üîπ ${escapeHtml(ing.name)} (${ing.amount} ${ing.unit}) - ${ing.category}
                    <button type="button" onclick="removeIngredient(${idx})">‚úï</button>
                </div>
            `).join('');
        }

        // Get Available Spices
        function getAvailableSpices() {
            const spices = [];
            const spiceMap = {
                'bumbu-garam': 'Garam',
                'bumbu-gula': 'Gula',
                'bumbu-merica': 'Merica',
                'bumbu-minyak': 'Minyak Goreng',
                'bumbu-kecap': 'Kecap Manis',
                'bumbu-bawang-putih': 'Bawang Putih',
                'bumbu-bawang-merah': 'Bawang Merah',
                'bumbu-cabai': 'Cabai',
                'bumbu-santan': 'Santan',
                'bumbu-kemiri': 'Kemiri',
                'bumbu-kunyit': 'Kunyit',
                'bumbu-jahe': 'Jahe'
            };

            Object.keys(spiceMap).forEach(id => {
                if (document.getElementById(id).checked) {
                    spices.push(spiceMap[id]);
                }
            });

            // Save spices to localStorage
            const spiceCheckboxes = {};
            Object.keys(spiceMap).forEach(id => {
                spiceCheckboxes[id] = document.getElementById(id).checked;
            });
            saveToLocalStorage('spices', spiceCheckboxes);

            return spices;
        }

        // Build Prompt
        function buildPrompt() {
            if (state.ingredients.length < 2) {
                showMessage('Tambahkan minimal 2 bahan untuk membuat resep', 'error');
                return null;
            }

            const ingredients = state.ingredients.map(ing => 
                `${ing.name} (${ing.amount} ${ing.unit})`
            ).join(', ');

            const spices = getAvailableSpices();
            const allergies = document.getElementById('allergies').value.trim();
            const spiceLevel = document.getElementById('spiceLevel').value;
            const cookingMethod = document.getElementById('cookingMethod').value;
            const maxTime = document.getElementById('maxTime').value;
            const difficulty = document.getElementById('difficulty').value;

            const prompt = `Kamu adalah chef profesional Indonesia. Generate 2-3 resep berbeda menggunakan bahan-bahan berikut:

BAHAN UTAMA:
${ingredients}

BUMBU YANG TERSEDIA:
${spices.join(', ') || 'Hanya bumbu dasar (garam, gula, minyak)'}

PREFERENSI:
- Tingkat Pedas: ${spiceLevel}
- Metode Masak: ${cookingMethod}
- Waktu Maksimal: ${maxTime} menit
- Tingkat Kesulitan: ${difficulty}
${allergies ? `- Hindari: ${allergies}` : ''}

INSTRUKSI:
1. Gunakan SEMUA bahan yang disebutkan sebagai bahan utama
2. Setiap resep harus berbeda metode masak jika memungkinkan
3. Respons HARUS dalam format JSON MURNI (bukan teks biasa), dengan struktur:
{
  "recipes": [
    {
      "name": "Nama Resep",
      "time": "XX menit",
      "difficulty": "Mudah/Sedang/Sulit",
      "spiceLevel": 1-5,
      "cookingMethod": "Metode",
      "ingredients": ["Bahan 1", "Bahan 2"],
      "spices": ["Bumbu 1", "Bumbu 2"],
      "steps": ["Langkah 1", "Langkah 2"],
      "tips": "Tips masakan",
      "warnings": "Jika ada bahan kurang"
    }
  ]
}

Pastikan JSON valid dan dapat di-parse!`;

            return prompt;
        }

        // Generate Recipes with DeepSeek API
        async function generateRecipes() {
            const prompt = buildPrompt();
            if (!prompt) return;

            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;

            showLoading();

            try {
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-0dec28d74d954d26b8c56d3841a54d6f'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: 'Kamu adalah chef profesional Indonesia yang ahli dalam memasak. Selalu respons dalam format JSON yang valid dan dapat di-parse.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('‚ùå API Key tidak valid atau tidak terotorisasi');
                    } else if (response.status === 429) {
                        throw new Error('‚è±Ô∏è Terlalu banyak permintaan. Coba lagi dalam beberapa detik');
                    } else if (response.status === 500) {
                        throw new Error('‚ùå Server DeepSeek sedang bermasalah. Coba lagi nanti');
                    } else {
                        throw new Error(`Gagal menghubungi server: ${response.status}`);
                    }
                }

                const data = await response.json();

                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('‚ùå Respons API tidak valid');
                }

                let content = data.choices[0].message.content.trim();
                
                // Extract JSON from content
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error('‚ùå Respons bukan format JSON. Silakan coba lagi.');
                }

                const recipes = JSON.parse(jsonMatch[0]);

                if (!recipes.recipes || !Array.isArray(recipes.recipes)) {
                    throw new Error('‚ùå Format resep tidak sesuai');
                }

                renderRecipes(recipes.recipes);
                
                // Save to history
                state.history.unshift({
                    ingredients: state.ingredients,
                    recipes: recipes.recipes,
                    timestamp: new Date().toLocaleString('id-ID')
                });
                if (state.history.length > 10) state.history.pop();
                saveToLocalStorage('history', state.history);

                showMessage('‚úÖ Resep berhasil dibuat!', 'success');

            } catch (error) {
                console.error('Error:', error);
                showMessage(error.message, 'error');
                document.getElementById('recipesContainer').innerHTML = `
                    <div class="empty-state">
                        <p>‚ö†Ô∏è ${escapeHtml(error.message)}</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
            }
        }

        // Render Recipes
        function renderRecipes(recipes) {
            const container = document.getElementById('recipesContainer');
            container.innerHTML = recipes.map((recipe, idx) => `
                <div class="recipe-card">
                    <div class="recipe-header">
                        <div class="recipe-title">${escapeHtml(recipe.name)}</div>
                        <div class="recipe-badges">
                            <span class="badge">‚è±Ô∏è ${escapeHtml(recipe.time)}</span>
                            <span class="badge">${getDifficultyBadge(recipe.difficulty)}</span>
                            <span class="badge">üî• Level ${recipe.spiceLevel}/5</span>
                        </div>
                    </div>
                    <div class="recipe-body">
                        <div class="recipe-section">
                            <h4>Bahan Utama</h4>
                            <ul>
                                ${(recipe.ingredients || []).map(ing => `<li>${escapeHtml(ing)}</li>`).join('')}
                            </ul>
                        </div>

                        ${recipe.spices && recipe.spices.length > 0 ? `
                            <div class="recipe-section">
                                <h4>Bumbu</h4>
                                <ul>
                                    ${recipe.spices.map(sp => `<li>${escapeHtml(sp)}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}

                        <div class="recipe-section">
                            <h4>Cara Memasak</h4>
                            <ol>
                                ${(recipe.steps || []).map(step => `<li>${escapeHtml(step)}</li>`).join('')}
                            </ol>
                        </div>

                        ${recipe.tips ? `
                            <div class="tips-box">
                                <strong>üí° Tips:</strong> ${escapeHtml(recipe.tips)}
                            </div>
                        ` : ''}

                        ${recipe.warnings ? `
                            <div class="warning-box">
                                <strong>‚ö†Ô∏è Perhatian:</strong> ${escapeHtml(recipe.warnings)}
                            </div>
                        ` : ''}
                    </div>
                    <div class="recipe-footer">
                        <button onclick="saveRecipe(${idx}, '${escapeHtml(recipe.name).replace(/'/g, "\\'")}')">‚≠ê Simpan</button>
                        <button onclick="copyIngredients(${idx})">üìã Copy</button>
                        <button onclick="shareRecipe('${escapeHtml(recipe.name).replace(/'/g, "\\'")}')" >üîó Share</button>
                        <button onclick="printRecipe(${idx}, '${escapeHtml(recipe.name).replace(/'/g, "\\'")}')" >üñ®Ô∏è Print</button>
                    </div>
                </div>
            `).join('');
        }

        function getDifficultyBadge(difficulty) {
            const badges = {
                'Mudah': 'üü¢ Mudah',
                'Sedang': 'üü° Sedang',
                'Sulit': 'üî¥ Sulit'
            };
            return badges[difficulty] || difficulty;
        }

        function saveRecipe(idx, name) {
            const container = document.getElementById('recipesContainer');
            const recipe = container.querySelector(`.recipe-card:nth-child(${idx + 1})`);
            const content = recipe.innerHTML;
            
            state.favorites.push({ name, content, timestamp: new Date().toLocaleString('id-ID') });
            saveToLocalStorage('favorites', state.favorites);
            showMessage('‚úÖ Resep disimpan ke favorit!', 'success');
        }

        function copyIngredients(idx) {
            const container = document.getElementById('recipesContainer');
            const recipe = container.querySelector(`.recipe-card:nth-child(${idx + 1})`);
            const ingredients = Array.from(recipe.querySelectorAll('.recipe-section:first-child ul li'))
                .map(li => li.textContent)
                .join('\n');
            
            navigator.clipboard.writeText(ingredients).then(() => {
                showMessage('üìã Daftar bahan disalin!', 'success');
            });
        }

        function shareRecipe(name) {
            const text = `Cek resep "${name}" dari Smart Leftover Chef! üç≥`;
            const url = window.location.href;
            
            if (navigator.share) {
                navigator.share({ title: 'Smart Leftover Chef', text, url });
            } else {
                navigator.clipboard.writeText(`${text}\n${url}`);
                showMessage('üîó Link resep disalin!', 'success');
            }
        }

        function printRecipe(idx, name) {
            const container = document.getElementById('recipesContainer');
            const recipe = container.querySelector(`.recipe-card:nth-child(${idx + 1})`);
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write(`
                <html><head><title>${name}</title>
                <style>
                    body { font-family: Arial; line-height: 1.6; margin: 20px; }
                    h1, h2 { color: #FF9F43; }
                    ul, ol { margin: 10px 0; }
                    li { margin: 5px 0; }
                </style></head><body>
                <h1>${name}</h1>
                ${recipe.innerHTML}
                </body></html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function showLoading() {
            document.getElementById('recipesContainer').innerHTML = `
                <div class="loading-container" style="grid-column: 1/-1;">
                    <div class="loading-animation">
                        <span class="cooking-icon">üç≥</span>
                        <span class="cooking-icon">üî™</span>
                    </div>
                    <p style="color: var(--text-light); font-size: 1.1em;">Koki sedang merancik resep spesial...</p>
                    <div class="progress-bar"><div class="progress-fill"></div></div>
                </div>
            `;
        }

        function showMessage(msg, type) {
            const msgEl = document.getElementById('successMessage');
            msgEl.textContent = msg;
            msgEl.className = `success-message show`;
            if (type === 'error') msgEl.style.borderLeftColor = 'var(--danger)';
            if (type === 'error') msgEl.style.color = 'var(--danger)';
            if (type === 'error') msgEl.style.backgroundColor = 'rgba(231, 76, 60, 0.1)';
            
            setTimeout(() => msgEl.classList.remove('show'), 5000);
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Event Listeners
        document.getElementById('ingredientName').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('ingredientAmount').focus();
            }
        });

        document.getElementById('ingredientAmount').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('ingredientUnit').focus();
            }
        });

        document.getElementById('ingredientUnit').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('ingredientCategory').focus();
            }
        });

        document.getElementById('ingredientCategory').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addIngredient();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                generateRecipes();
            }
        });

        // Initialize
        initializeSpices();
    </script>
</body>
</html>
